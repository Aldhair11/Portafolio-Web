---
import Layout from "../layouts/Layout.astro"
import "../styles/pages/contact.css";
import Swal from 'sweetalert2'; 

---

<Layout>
  <h2>Contacto</h2>
  <form id="contact-form">
    <label for="name">Nombres:</label>
    <input type="text" name="name" id="name" placeholder="Nombre y Apellido" required />

    <label for="telephone">Teléfono:</label>
    <input type="tel" name="telephone" id="telephone" placeholder="Telefono" required />

    <label for="email">Email:</label>
    <input type="email" name="email" id="email" placeholder="Correo Electrónico" required />

    <label for="message">Mensaje:</label>
    <textarea name="message" id="message" placeholder="Escriba su mensaje" required></textarea>

    <button type="submit">Enviar Información</button>
    <p id="form-status"></p>
  </form>
  <div class="alert-container">
    <div class="alert success" id="success-alert" style="display:none;">
        <strong>¡Éxito!</strong> El mensaje fue enviado correctamente.
    </div>

    <div class="alert error" id="error-alert" style="display:none;">
        <strong>Error</strong> Hubo un problema al enviar el mensaje.
    </div>

    <div class="alert warning" id="warning-alert" style="display:none;">
        <strong>Advertencia</strong> Por favor, llena todos los campos.
    </div>
</div>
<script type="module">
  document.querySelector('#contact-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const res = await fetch("http://localhost:5000/api/contact", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();  

      //limpia alertas previas
      document.getElementById('success-alert').style.display = 'none';
      document.getElementById('error-alert').style.display = 'none';
      document.getElementById('warning-alert').style.display = 'none';

      if (res.ok && result.success) {
        // alerta de envio
        const successAlert = document.getElementById('success-alert');
        successAlert.style.display = 'block';
        setTimeout(() => successAlert.style.display = 'none', 5000);  
        form.reset();  
      } else {
        //alerta de error
        const errorAlert = document.getElementById('error-alert');
        errorAlert.style.display = 'block';
        setTimeout(() => errorAlert.style.display = 'none', 5000);
      }
    } catch (err) {
      console.log('Error:', err);  

      //alerta de error de red
      const errorAlert = document.getElementById('error-alert');
      errorAlert.style.display = 'block';
      setTimeout(() => errorAlert.style.display = 'none', 5000);  
    }
  });
</script>
</Layout>

